<div class="container" style="overflow-x: auto;">
  <div class="row"
    style="height: calc(150vh - 150px); width:2000px; border-radius: 10px; overflow: hidden; overflow-x: auto;">
    <ng-container *ngFor="let column of tickets">
      <div class="col" style="width: 40%;">
        <div class="card">
          <div class="card-body" style="background-color:#F1F2F4">
            <h5 class="card-title text-center" [ngClass]="column.class" (click)="logClass(column.status)">{{
              column.title }}</h5>
            <div class="row"
              style="height: calc(100vh - 100px); border-radius: 10px; overflow: hidden;background-color:white">
              <div class="col" style="height: 100%; overflow-y: auto">
                <div class="card" style="height: 100%;">
                  <div class="card-body" *ngFor="let ticket of column.data; let i = index;">
                    <div class="mb-3 row">
                      <div class="col" style="background-color: #F1F2F4; padding:30px;border-radius:10px">
                        <div class="d-flex justify-content-end " style="margin-right:-20px ;margin-top:-20px">
                          <button class="btn  col-2 ms-1 " data-bs-toggle="modal"
                            [attr.data-bs-target]="'#updateModal'+ i"
                            (click)="openTicketInfo(ticket._id, column.data[i].projet_id)">
                            <i class="fa-solid fa-marker"></i>
                          </button>
                        </div>
                        <div class="d-flex justify-content-end " style="margin-right:10px;margin-top:-30px">
                          <button class="btn  col-2 ms-1" data-bs-toggle="modal" [attr.data-bs-target]="'#infoModal'+ i"
                            (click)="openTicketInfo(ticket._id, column.data[i].projet_id)">
                            <i class="fa-regular fa-file"></i>
                          </button>

                        </div>
                        <div class="d-flex justify-content-end " style="margin-right:40px;margin-top:-30px">
                          <button class="btn  col-2 ms-1" data-bs-toggle="modal"
                            [attr.data-bs-target]="'#deleteModal'+ i" (click)="openTicketInfoC(ticket._id, column.data[i].projet_id)">
                            <i class="fa-solid fa-trash"></i>
                          </button>
                        </div>
                        <div class="d-flex justify-content-end " style="margin-right:70px;margin-top:-30px">
                          <button class="btn  col-2 ms-1" data-bs-toggle="modal"
                            [attr.data-bs-target]="'#commentsModal'+ i"
                            (click)="openTicketInfoC(ticket._id, column.data[i].projet_id)">
                            <i class="fa-solid fa-comment-dots"></i>
                          </button>
                        </div>
                        <input class="form-control text-center" type="text" style="background-color: white;"
                          [value]="ticket.titre" id="title{{i}}" readonly>
                        <div class="text-center">


                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal"
              (click)="setNewTicketStatus(column.status)"><i class="fa-solid fa-folder-plus"></i></button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>


<!-- Modal -->
<div *ngFor="let column of tickets; let j = index">
  <div class="modal fade" [id]="'infoModal'+j" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Information Ticket</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 row">
            <label for="ticketTitle" class="col-sm-3 col-form-label">Title:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketTitle" [value]="currentTicket?.titre" readonly>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="ticketType" class="col-sm-3 col-form-label">Type:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketType" [value]="currentTicket?.type" readonly>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="ticketDateOuverture" class="col-sm-3 col-form-label">Date Ouverture:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketDateOuverture"
                [value]="currentTicket?.dateOverture| date: 'yyyy-MM-dd'" readonly>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="ticketDateCloture" class="col-sm-3 col-form-label">Date Cloture:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketDateCloture"
                [value]="currentTicket?.dateCloture| date: 'yyyy-MM-dd'" readonly>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="assigne_a" class="col-sm-3 col-form-label">Assigné à:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketDateCloture" [value]="currentTicket?.assigne_aName"
                readonly>

            </div>
          </div>

          <div class="mb-3 row">
            <label for="rapporteur" class="col-sm-3 col-form-label">Rapporteur:</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="ticketDateCloture" [value]="currentTicket?.rapporteurName"
                readonly>

            </div>
          </div>
          <div class="mb-3 row">
            <label for="commentaires" class="col-sm-12 col-form-label text-center ">Commentaires</label>
            <div class="col-sm-12">
              <ul class="list-group">
                <li class="list-group-item commentaire" *ngFor="let commentaire of commentaires">

                  <div class="commentaire-content">
                    <div class="commentaire-header">
                      <button class="btn" (click)="toggleEdit(commentaire)">
                        <i class="fa-solid fa-marker"></i>
                      </button>
                      <button class="btn" (click)="deleteComment(commentaire._id)">
                        <i class="fa-solid fa-trash"></i>
                      </button>

                      <span class="commentaire-date">{{ commentaire.createdAt | date: 'medium' }}  </span>
                    </div>
                    <div *ngIf="!commentaire.editMode" class="commentaire-text">{{ commentaire.comment }}</div>
                    <div *ngIf="commentaire.editMode">
                      <textarea class="form-control" [(ngModel)]="commentaire.updatedComment"></textarea>
                      <button class="btn btn-primary" (click)="updateComment(commentaire)">Modifier</button>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>




          <!-- Add other ticket details here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<!-- Modal -->
<!-- Update Modals for each project -->



<!-- Update Ticket Modal -->
<div *ngFor="let column of tickets; let j = index">
  <div class="modal fade" [id]="'updateModal'+j" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Modifier Ticket</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form #updateForm="ngForm">
            <div class="mb-3 row">
              <label for="titre" class="col-sm-3 col-form-label">Title:</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="ticketTitle" name="titre" [(ngModel)]="updatedTicket.titre"
                  required>
              </div>
            </div>
            <div class="mb-3 row">
              <label for="type" class="col-sm-3 col-form-label">Type:</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="type" name="type" [(ngModel)]="updatedTicket.type">
              </div>
            </div>
            <div class="mb-3 row">
              <label for="statut" class="col-sm-3 col-form-label">Status:</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="statut" name="statut" [(ngModel)]="updatedTicket.statut">
              </div>
            </div>
            <div class="mb-3 row">
              <label for="dateOverture" class="col-sm-3 col-form-label">Date Ouverture:</label>
              <div class="col-sm-9">
                <input type="date" class="form-control" id="dateOverture" name="dateOverture"
                  [(ngModel)]="updatedTicket.dateOverture">
              </div>
            </div>
            <div class="mb-3 row">
              <label for="dateCloture" class="col-sm-3 col-form-label">Date Cloture:</label>
              <div class="col-sm-9">
                <input type="date" class="form-control" id="dateCloture" name="dateCloture"
                  [(ngModel)]="updatedTicket.dateCloture">
              </div>
            </div>
            <div class="mb-3 row">
              <label for="description" class="col-sm-3 col-form-label">Description:</label>
              <div class="col-sm-9">
                <textarea class="form-control" id="description" name="description"
                  [(ngModel)]="updatedTicket.description"></textarea>
              </div>
            </div>
            <div class="mb-3 row">
              <label for="pieceJointe" class="col-sm-3 col-form-label">Piece Jointe:</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="pieceJointe" name="pieceJointe"
                  [(ngModel)]="updatedTicket.pieceJointe">
              </div>
            </div>
            <div class="mb-3 row">
              <label for="assigne_a" class="col-sm-3 col-form-label">Assigné à:</label>
              <div class="col-sm-9">
                <select class="form-control" id="assigne_a" name="assigne_a" [(ngModel)]="updatedTicket.assigne_a">
                  <option *ngFor="let user of equipeUsers" [value]="user._id" [selected]="updatedTicket.assigne_a">{{
                    user.nom }}</option>
                </select>
              </div>
            </div>
            <div class="mb-3 row">
              <label for="rapporteur" class="col-sm-3 col-form-label">Rapporteur:</label>
              <div class="col-sm-9">
                <select class="form-control" id="rapporteur" name="rapporteur" [(ngModel)]="updatedTicket.rapporteur">
                  <option *ngFor="let user of equipeUsers" [value]="user._id" [selected]="updatedTicket.rapporteur">{{
                    user.nom }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary"
            (click)="updateTicket(currentTicket?._id, currentTicket?.projet_id, currentTicket?.assigne_a, updatedTicket)">Sauvegarder
            changements</button>
        </div>
      </div>
    </div>
  </div>
</div>





<!-- Add Ticket Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">Ajouter un nouveau Ticket</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form #newTicketForm="ngForm">
          <div class="mb-3">
            <label for="titre" class="form-label">Title</label>
            <input type="text" class="form-control" id="titre" name="titre" [(ngModel)]="newTicket.titre" required>
          </div>
          <div class="mb-3">
            <label for="type" class="form-label">Type</label>
            <input type="text" class="form-control" id="type" name="type" [(ngModel)]="newTicket.type">
          </div>

          <div class="mb-3">
            <label for="dateOverture" class="form-label">Date Ouverture</label>
            <input type="datetime-local" class="form-control" id="dateOverture" name="dateOverture"
              [(ngModel)]="newTicket.dateOverture">
          </div>
          <div class="mb-3">
            <label for="dateCloture" class="form-label">Date Cloture</label>
            <input type="datetime-local" class="form-control" id="dateCloture" name="dateCloture"
              [(ngModel)]="newTicket.dateCloture">
          </div>
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description"
              [(ngModel)]="newTicket.description"></textarea>
          </div>
          <div class="mb-3">
            <label for="pieceJointe" class="form-label">Piece Jointe</label>
            <input type="text" class="form-control" id="pieceJointe" name="pieceJointe"
              [(ngModel)]="newTicket.pieceJointe">
          </div>


          <div class="mb-3 row">
            <label for="assigne_a" class="col-sm-3 col-form-label">Assigné à:</label>
            <div class="col-sm-9">
              <select class="form-control" id="assigne_a" name="assigne_a" [(ngModel)]="newTicket.assigne_a">
                <option *ngFor="let user of equipeUsers" [value]="user._id" [selected]="newTicket.assigne_a">{{ user.nom
                  }}</option>
              </select>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="rapporteur" class="col-sm-3 col-form-label">Rapporteur:</label>
            <div class="col-sm-9">
              <select class="form-control" id="rapporteur" name="rapporteur" [(ngModel)]="newTicket.rapporteur">
                <option *ngFor="let user of equipeUsers" [value]="user._id" [selected]="newTicket.rapporteur">{{
                  user.nom }}</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label for="validateur" class="form-label">Validateur</label>
            <input type="text" class="form-control" id="validateur" name="validateur"
              [(ngModel)]="newTicket.validateur">
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-primary" (click)="createNewTicket(newTicket)"
          [disabled]="!newTicketForm.valid">
          Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal commentaire -->
<div *ngFor="let column of tickets; let j = index">
  <div class="modal fade" [id]="'commentsModal'+j" tabindex="-1" aria-labelledby="commentsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="commentsModalLabel">Commentaire</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form #commentForm="ngForm" >
          <div class="modal-body">

            <div class="mb-3">
              <textarea class="form-control" id="commentaire" name="commentaire" [(ngModel)]="commentaire" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <button type="button" class="btn btn-primary" (click)="addComment(currentTicket._id, commentForm)">Ajouter Commentaire</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>






<!-- Delete Modal -->
<div *ngFor="let column of tickets; let j = index">

  <div class="modal fade" [id]="'deleteModal'+j" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">

  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">supprimer Ticket</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Êtes-vous sûr de vouloir supprimer ce ticket ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteTicket(currentTicket._id)">supprimer</button>
      </div>
    </div>
  </div>
</div>
</div>




